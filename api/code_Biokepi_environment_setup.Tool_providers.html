<html><head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of extensions" rel=Appendix href="index_extensions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Biokepi_run_environment" rel="Chapter" href="Biokepi_run_environment.html">
<link title="Biokepi_environment_setup" rel="Chapter" href="Biokepi_environment_setup.html">
<link title="Biokepi_bfx_tools" rel="Chapter" href="Biokepi_bfx_tools.html">
<link title="Biokepi_pipeline_edsl" rel="Chapter" href="Biokepi_pipeline_edsl.html">
<link title="All_downloads" rel="Chapter" href="All_downloads.html">
<link title="Main" rel="Chapter" href="Main.html">
<link title="Ttfi_pipeline" rel="Chapter" href="Ttfi_pipeline.html">
<link title="Biokepi" rel="Chapter" href="Biokepi.html"><title>Biokepi API : Biokepi_environment_setup.Tool_providers</title>
</head>
<body>
<code class="code"><span class="keyword">struct</span><br>
<br>
<span class="keyword">open</span>&nbsp;<span class="constructor">Biokepi_run_environment</span><br>
<span class="keyword">open</span>&nbsp;<span class="constructor">Common</span><br>
<br>
<span class="keyword">let</span>&nbsp;rm_path&nbsp;=&nbsp;<span class="constructor">Workflow_utilities</span>.<span class="constructor">Remove</span>.path_on_host<br>
<br>
<span class="keyword">let</span>&nbsp;generic_installation<br>
&nbsp;&nbsp;&nbsp;&nbsp;~(run_program&nbsp;:&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Make_fun</span>.t)<br>
&nbsp;&nbsp;&nbsp;&nbsp;~host&nbsp;~install_path&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;~install_program&nbsp;~witness&nbsp;~url<br>
&nbsp;&nbsp;&nbsp;&nbsp;?unarchived_directory<br>
&nbsp;&nbsp;&nbsp;&nbsp;tool_name&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;archive&nbsp;=&nbsp;<span class="constructor">Filename</span>.basename&nbsp;url&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;archive_kind&nbsp;=&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Filename</span>.check_suffix&nbsp;url&nbsp;<span class="string">"bz2"</span>&nbsp;<span class="keyword">then</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Tar</span>&nbsp;<span class="string">"j"</span>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Filename</span>.check_suffix&nbsp;url&nbsp;<span class="string">"gz"</span>&nbsp;&nbsp;<span class="keyword">then</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Tar</span>&nbsp;<span class="string">"z"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Filename</span>.check_suffix&nbsp;url&nbsp;<span class="string">"tar"</span>&nbsp;<span class="keyword">then</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Tar</span>&nbsp;<span class="string">""</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Filename</span>.check_suffix&nbsp;url&nbsp;<span class="string">"zip"</span>&nbsp;<span class="keyword">then</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Zip</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Filename</span>.check_suffix&nbsp;url&nbsp;<span class="string">"deb"</span>&nbsp;<span class="keyword">then</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Deb</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">None</span><br>
&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;<span class="keyword">open</span>&nbsp;<span class="constructor">KEDSL</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;unarchival&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;<span class="keyword">open</span>&nbsp;<span class="constructor">Program</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;and_cd&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shf&nbsp;<span class="string">"cd&nbsp;%s"</span>&nbsp;(<span class="constructor">Option</span>.value&nbsp;unarchived_directory<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~default:(tool_name&nbsp;^&nbsp;<span class="string">"*"</span>))&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;archive_kind&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Tar</span>&nbsp;tar_option&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chain&nbsp;[&nbsp;shf&nbsp;<span class="string">"tar&nbsp;xvf%s&nbsp;%s"</span>&nbsp;tar_option&nbsp;archive;&nbsp;and_cd&nbsp;]<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Zip</span>&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chain&nbsp;[&nbsp;shf&nbsp;<span class="string">"unzip&nbsp;%s"</span>&nbsp;archive;&nbsp;and_cd]<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Deb</span>&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chain&nbsp;[<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exec&nbsp;[<span class="string">"ar"</span>;&nbsp;<span class="string">"x"</span>;&nbsp;archive];<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exec&nbsp;[<span class="string">"tar"</span>;&nbsp;<span class="string">"xvfz"</span>;&nbsp;<span class="string">"data.tar.gz"</span>];<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">None</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;sh&nbsp;<span class="string">"echo&nbsp;Not-an-archive"</span><br>
&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;workflow_node<br>
&nbsp;&nbsp;&nbsp;&nbsp;~name:(sprintf&nbsp;<span class="string">"Install&nbsp;%s"</span>&nbsp;tool_name)<br>
&nbsp;&nbsp;&nbsp;&nbsp;witness<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;(single_file&nbsp;~host&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;(Option.value&nbsp;witness&nbsp;~default:(install_path&nbsp;//&nbsp;tool_name)))&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;~edges:[<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;on_failure_activate&nbsp;(rm_path&nbsp;~host&nbsp;install_path);<br>
&nbsp;&nbsp;&nbsp;&nbsp;]<br>
&nbsp;&nbsp;&nbsp;&nbsp;~make:(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;run_program<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~requirements:[<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">`</span><span class="constructor">Internet_access</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">`</span><span class="constructor">Self_identification</span>&nbsp;[<span class="string">"generic-instalation"</span>;&nbsp;tool_name];<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Program</span>.(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shf&nbsp;<span class="string">"mkdir&nbsp;-p&nbsp;%s"</span>&nbsp;install_path<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;shf&nbsp;<span class="string">"cd&nbsp;%s"</span>&nbsp;install_path<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;<span class="constructor">Workflow_utilities</span>.<span class="constructor">Download</span>.wget_program&nbsp;url<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;unarchival<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;install_program<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;sh&nbsp;<span class="string">"echo&nbsp;Done"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
<br>
<span class="keyword">module</span>&nbsp;<span class="constructor">Tool_def</span>&nbsp;=&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.<span class="constructor">Definition</span><br>
<br>
<span class="keyword">type</span>&nbsp;installable&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;tool_definition&nbsp;:&nbsp;<span class="constructor">Tool_def</span>.t;<br>
&nbsp;&nbsp;url&nbsp;:&nbsp;string;<br>
&nbsp;&nbsp;install_program&nbsp;:&nbsp;path:&nbsp;string&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">KEDSL</span>.<span class="constructor">Program</span>.t;<br>
&nbsp;&nbsp;init_program&nbsp;:&nbsp;path:&nbsp;string&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">KEDSL</span>.<span class="constructor">Program</span>.t;<br>
&nbsp;&nbsp;witness:&nbsp;host:&nbsp;<span class="constructor">KEDSL</span>.<span class="constructor">Host</span>.t&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;path:&nbsp;string&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">KEDSL</span>.unknown_product;<br>
&nbsp;&nbsp;unarchived_directory&nbsp;:&nbsp;string&nbsp;option;<br>
}<br>
<span class="keyword">let</span>&nbsp;noop&nbsp;=&nbsp;<span class="constructor">KEDSL</span>.<span class="constructor">Program</span>.sh&nbsp;<span class="string">"echo&nbsp;Nothing-done-here"</span><br>
<br>
<br>
<span class="keyword">let</span>&nbsp;installable_tool&nbsp;~url<br>
&nbsp;&nbsp;&nbsp;&nbsp;?(install_program&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;~path&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;noop)<br>
&nbsp;&nbsp;&nbsp;&nbsp;?(init_program&nbsp;=&nbsp;<span class="keyword">fun</span>&nbsp;~path&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;noop)<br>
&nbsp;&nbsp;&nbsp;&nbsp;~witness<br>
&nbsp;&nbsp;&nbsp;&nbsp;?unarchived_directory<br>
&nbsp;&nbsp;&nbsp;&nbsp;tool_definition&nbsp;=<br>
&nbsp;&nbsp;{tool_definition;&nbsp;url;&nbsp;install_program;<br>
&nbsp;&nbsp;&nbsp;init_program;&nbsp;witness;&nbsp;unarchived_directory}<br>
<br>
<span class="keyword">let</span>&nbsp;render_installable_tool&nbsp;~run_program&nbsp;~host&nbsp;~install_tools_path&nbsp;tool&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;path&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;install_tools_path&nbsp;//&nbsp;<span class="constructor">Tool_def</span>.to_directory_name&nbsp;tool.tool_definition&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;&nbsp;ensure&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;generic_installation<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;?unarchived_directory:tool.unarchived_directory<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~run_program&nbsp;~host&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~install_path:path<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~install_program:(tool.install_program&nbsp;~path)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~witness:(tool.witness&nbsp;~host&nbsp;~path)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~url:tool.url<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(tool.tool_definition.<span class="constructor">Tool_def</span>.name)<br>
&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.create&nbsp;tool.tool_definition&nbsp;~ensure<br>
&nbsp;&nbsp;&nbsp;&nbsp;~init:(tool.init_program&nbsp;path)<br>
<br>
<span class="keyword">let</span>&nbsp;add_to_dollar_path&nbsp;~path&nbsp;=&nbsp;<span class="constructor">KEDSL</span>.<span class="constructor">Program</span>.shf&nbsp;<span class="string">"export&nbsp;PATH=%s:$PATH"</span>&nbsp;path<br>
<br>
<span class="keyword">let</span>&nbsp;make_and_copy_bin&nbsp;bin&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">fun</span>&nbsp;~path&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">KEDSL</span>.<span class="constructor">Program</span>.(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sh&nbsp;<span class="string">"make"</span>&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;shf&nbsp;<span class="string">"cp&nbsp;%s&nbsp;%s"</span>&nbsp;bin&nbsp;path<br>
&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<span class="keyword">let</span>&nbsp;witness_file&nbsp;bin&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">fun</span>&nbsp;~host&nbsp;~path&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;p&nbsp;=&nbsp;<span class="constructor">KEDSL</span>.single_file&nbsp;~host&nbsp;(path&nbsp;//&nbsp;bin)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">object</span>&nbsp;<span class="keyword">method</span>&nbsp;is_done&nbsp;=&nbsp;p<span class="keywordsign">#</span>is_done&nbsp;<span class="keyword">end</span><br>
<span class="keyword">let</span>&nbsp;witness_list&nbsp;l&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">fun</span>&nbsp;~host&nbsp;~path&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">KEDSL</span>.list_of_files&nbsp;~host&nbsp;(<span class="constructor">List</span>.map&nbsp;l&nbsp;~f:(<span class="keyword">fun</span>&nbsp;bin&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;path&nbsp;//&nbsp;bin))<br>
&nbsp;&nbsp;&nbsp;&nbsp;|&gt;&nbsp;<span class="keyword">fun</span>&nbsp;p&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">object</span>&nbsp;<span class="keyword">method</span>&nbsp;is_done&nbsp;=&nbsp;p<span class="keywordsign">#</span>is_done&nbsp;<span class="keyword">end</span><br>
<br>
<span class="keyword">let</span>&nbsp;bwa&nbsp;=&nbsp;<br>
&nbsp;&nbsp;installable_tool&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.<span class="constructor">Default</span>.bwa<br>
&nbsp;&nbsp;&nbsp;&nbsp;~url:<span class="string">"http://downloads.sourceforge.net/project/bio-bwa/bwa-0.7.10.tar.bz2"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;~install_program:(make_and_copy_bin&nbsp;<span class="string">"bwa"</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;~init_program:add_to_dollar_path<br>
&nbsp;&nbsp;&nbsp;&nbsp;~witness:(witness_file&nbsp;<span class="string">"bwa"</span>)<br>
<br>
<span class="keyword">let</span>&nbsp;stringtie&nbsp;=<br>
&nbsp;&nbsp;installable_tool<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.<span class="constructor">Default</span>.stringtie<br>
&nbsp;&nbsp;&nbsp;&nbsp;~url:<span class="string">"https://github.com/gpertea/stringtie/archive/v1.2.2.tar.gz"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;~install_program:(make_and_copy_bin&nbsp;<span class="string">"stringtie"</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;~init_program:add_to_dollar_path<br>
&nbsp;&nbsp;&nbsp;&nbsp;~witness:(witness_file&nbsp;<span class="string">"stringtie"</span>)<br>
<br>
<span class="keyword">let</span>&nbsp;vcftools&nbsp;=<br>
&nbsp;&nbsp;installable_tool&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.<span class="constructor">Default</span>.vcftools<br>
&nbsp;&nbsp;&nbsp;&nbsp;~url:<span class="string">"http://downloads.sourceforge.net/project/vcftools/vcftools_0.1.12b.tar.gz"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;~install_program:(<span class="keyword">fun</span>&nbsp;~path&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">KEDSL</span>.<span class="constructor">Program</span>.(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sh&nbsp;<span class="string">"make"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;shf&nbsp;&nbsp;<span class="string">"cp&nbsp;-r&nbsp;bin&nbsp;%s"</span>&nbsp;path<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;shf&nbsp;&nbsp;<span class="string">"cp&nbsp;-r&nbsp;lib/perl5/site_perl&nbsp;%s"</span>&nbsp;path<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
&nbsp;&nbsp;&nbsp;&nbsp;~witness:(witness_file&nbsp;@@&nbsp;<span class="string">"bin"</span>&nbsp;//&nbsp;<span class="string">"vcftools"</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;~init_program:(<span class="keyword">fun</span>&nbsp;~path&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">KEDSL</span>.<span class="constructor">Program</span>.(shf&nbsp;<span class="string">"export&nbsp;PATH=%s/bin/:$PATH"</span>&nbsp;path<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;shf&nbsp;<span class="string">"export&nbsp;PERL5LIB=$PERL5LIB:%s/site_perl/"</span>&nbsp;path))<br>
<br>
<span class="keyword">let</span>&nbsp;bedtools&nbsp;=<br>
&nbsp;&nbsp;installable_tool&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.<span class="constructor">Default</span>.bedtools<br>
&nbsp;&nbsp;&nbsp;&nbsp;~url:<span class="string">"https://github.com/arq5x/bedtools2/archive/v2.23.0.tar.gz"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;~install_program:(<span class="keyword">fun</span>&nbsp;~path&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">KEDSL</span>.<span class="constructor">Program</span>.(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sh&nbsp;<span class="string">"make"</span>&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;shf&nbsp;<span class="string">"cp&nbsp;-r&nbsp;bin&nbsp;%s"</span>&nbsp;path))<br>
&nbsp;&nbsp;&nbsp;&nbsp;~init_program:(<span class="keyword">fun</span>&nbsp;~path&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">KEDSL</span>.<span class="constructor">Program</span>.(shf&nbsp;<span class="string">"export&nbsp;PATH=%s/bin/:$PATH"</span>&nbsp;path))<br>
&nbsp;&nbsp;&nbsp;&nbsp;~witness:(witness_file&nbsp;@@&nbsp;<span class="string">"bin"</span>&nbsp;//&nbsp;<span class="string">"bedtools"</span>)<br>
<br>
<span class="keyword">let</span>&nbsp;mosaik&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;url&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"https://mosaik-aligner.googlecode.com/files/MOSAIK-2.2.3-source.tar"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;installable_tool&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.<span class="constructor">Default</span>.mosaik&nbsp;~url<br>
&nbsp;&nbsp;&nbsp;&nbsp;~unarchived_directory:<span class="string">"MOSAIK*"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;~init_program:(<span class="keyword">fun</span>&nbsp;~path&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">KEDSL</span>.<span class="constructor">Program</span>.(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shf&nbsp;<span class="string">"export&nbsp;PATH=%s:$PATH"</span>&nbsp;path<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;shf&nbsp;<span class="string">"export&nbsp;MOSAIK_PE_ANN=%s/pe.ann"</span>&nbsp;path<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;shf&nbsp;<span class="string">"export&nbsp;MOSAIK_SE_ANN=%s/se.ann"</span>&nbsp;path<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;))<br>
&nbsp;&nbsp;&nbsp;&nbsp;~witness:(witness_file&nbsp;<span class="string">"MosaikAligner"</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;~install_program:<span class="constructor">KEDSL</span>.<span class="constructor">Program</span>.(<span class="keyword">fun</span>&nbsp;~path&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sh&nbsp;<span class="string">"make"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;shf&nbsp;<span class="string">"cp&nbsp;networkFile/*pe.ann&nbsp;%s/pe.ann"</span>&nbsp;path<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;shf&nbsp;<span class="string">"cp&nbsp;networkFile/*se.ann&nbsp;%s/se.ann"</span>&nbsp;path<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;shf&nbsp;<span class="string">"cp&nbsp;bin/*&nbsp;%s"</span>&nbsp;path<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
<br>
<span class="keyword">let</span>&nbsp;star&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;url&nbsp;=&nbsp;<span class="string">"https://github.com/alexdobin/STAR/archive/STAR_2.4.1d.tar.gz"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;star_binary&nbsp;=&nbsp;<span class="string">"STAR"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;TODO:&nbsp;there&nbsp;are&nbsp;other&nbsp;binaries&nbsp;in&nbsp;`bin/`&nbsp;*)</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;star_binary_path&nbsp;=&nbsp;sprintf&nbsp;<span class="string">"bin/Linux_x86_64/%s"</span>&nbsp;star_binary&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;installable_tool&nbsp;~url&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.<span class="constructor">Default</span>.star<br>
&nbsp;&nbsp;&nbsp;&nbsp;~init_program:add_to_dollar_path<br>
&nbsp;&nbsp;&nbsp;&nbsp;~unarchived_directory:<span class="string">"STAR-*"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;~install_program:<span class="constructor">KEDSL</span>.<span class="constructor">Program</span>.(<span class="keyword">fun</span>&nbsp;~path&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shf&nbsp;<span class="string">"cp&nbsp;%s&nbsp;%s"</span>&nbsp;star_binary_path&nbsp;path)<br>
&nbsp;&nbsp;&nbsp;&nbsp;~witness:(witness_file&nbsp;star_binary)<br>
<br>
<span class="keyword">let</span>&nbsp;hisat&nbsp;tool&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;<span class="keyword">open</span>&nbsp;<span class="constructor">KEDSL</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;url,&nbsp;hisat_binary&nbsp;=&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;<span class="keyword">open</span>&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.<span class="constructor">Default</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;tool&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;one&nbsp;<span class="keyword">when</span>&nbsp;one&nbsp;=&nbsp;hisat&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"http://ccb.jhu.edu/software/hisat/downloads/hisat-0.1.6-beta-Linux_x86_64.zip"</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"hisat"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;two&nbsp;<span class="keyword">when</span>&nbsp;two&nbsp;=&nbsp;hisat2&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"ftp://ftp.ccb.jhu.edu/pub/infphilo/hisat2/downloads/hisat2-2.0.2-beta-Linux_x86_64.zip"</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"hisat2"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;other&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;failwithf&nbsp;<span class="string">"Can't&nbsp;install&nbsp;Hisat&nbsp;version:&nbsp;%s"</span>&nbsp;(<span class="constructor">Tool_def</span>.to_string&nbsp;other)<br>
&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;installable_tool&nbsp;tool<br>
&nbsp;&nbsp;&nbsp;&nbsp;~url<br>
&nbsp;&nbsp;&nbsp;&nbsp;~witness:(witness_file&nbsp;hisat_binary)<br>
&nbsp;&nbsp;&nbsp;&nbsp;~install_program:<span class="constructor">KEDSL</span>.<span class="constructor">Program</span>.(<span class="keyword">fun</span>&nbsp;~path&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shf&nbsp;<span class="string">"mv&nbsp;hisat*&nbsp;%s"</span>&nbsp;path<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
&nbsp;&nbsp;~init_program:add_to_dollar_path<br>
<br>
<span class="keyword">let</span>&nbsp;kallisto&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;url&nbsp;=&nbsp;<span class="string">"https://github.com/pachterlab/kallisto/releases/download/v0.42.3/kallisto_linux-v0.42.3.tar.gz"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;installable_tool&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.<span class="constructor">Default</span>.kallisto&nbsp;~url<br>
&nbsp;&nbsp;&nbsp;&nbsp;~witness:(witness_file&nbsp;<span class="string">"kallisto"</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;~install_program:<span class="constructor">KEDSL</span>.<span class="constructor">Program</span>.(<span class="keyword">fun</span>&nbsp;~path&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shf&nbsp;<span class="string">"cp&nbsp;-r&nbsp;*&nbsp;%s"</span>&nbsp;path<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
&nbsp;&nbsp;~init_program:add_to_dollar_path<br>
<br>
<span class="keyword">let</span>&nbsp;samtools&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;url&nbsp;=&nbsp;<span class="string">"https://github.com/samtools/samtools/releases/download/1.3/samtools-1.3.tar.bz2"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;toplevel_tools&nbsp;=&nbsp;[<span class="string">"samtools"</span>]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;htslib&nbsp;=&nbsp;[<span class="string">"bgzip"</span>;&nbsp;<span class="string">"tabix"</span>&nbsp;]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;tools&nbsp;=&nbsp;toplevel_tools&nbsp;@&nbsp;htslib&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;install_program&nbsp;~path&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;<span class="keyword">open</span>&nbsp;<span class="constructor">KEDSL</span>.<span class="constructor">Program</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;sh&nbsp;<span class="string">"make"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;shf&nbsp;<span class="string">"cp&nbsp;%s&nbsp;%s"</span>&nbsp;(<span class="constructor">String</span>.concat&nbsp;toplevel_tools&nbsp;~sep:<span class="string">"&nbsp;"</span>)&nbsp;&nbsp;path<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;sh&nbsp;<span class="string">"cd&nbsp;htslib*/"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;sh&nbsp;<span class="string">"make"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;shf&nbsp;<span class="string">"cp&nbsp;%s&nbsp;%s"</span>&nbsp;(<span class="constructor">String</span>.concat&nbsp;htslib&nbsp;~sep:<span class="string">"&nbsp;"</span>)&nbsp;path<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;sh&nbsp;<span class="string">"echo&nbsp;Done"</span><br>
&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;witness&nbsp;=&nbsp;witness_list&nbsp;tools&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;installable_tool&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.<span class="constructor">Default</span>.samtools&nbsp;~url&nbsp;~install_program<br>
&nbsp;&nbsp;&nbsp;&nbsp;~init_program:add_to_dollar_path&nbsp;~witness<br>
<br>
<br>
<span class="keyword">let</span>&nbsp;cufflinks&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;url&nbsp;=&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"http://cole-trapnell-lab.github.io/cufflinks/assets/downloads/cufflinks-2.2.1.Linux_x86_64.tar.gz"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;witness&nbsp;=&nbsp;witness_file&nbsp;<span class="string">"cufflinks"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;install_program&nbsp;~path&nbsp;=&nbsp;<span class="constructor">KEDSL</span>.<span class="constructor">Program</span>.(shf&nbsp;<span class="string">"cp&nbsp;*&nbsp;%s"</span>&nbsp;path)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;installable_tool&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.<span class="constructor">Default</span>.cufflinks&nbsp;~install_program&nbsp;~url&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;~init_program:add_to_dollar_path&nbsp;~witness<br>
<br>
<span class="keyword">let</span>&nbsp;somaticsniper&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;url&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;deb_file&nbsp;=&nbsp;<span class="string">"somatic-sniper1.0.3_1.0.3_amd64.deb"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;sprintf<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"http://apt.genome.wustl.edu/ubuntu/pool/main/s/somatic-sniper1.0.3/%s"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;deb_file<br>
&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;binary&nbsp;=&nbsp;<span class="string">"somaticsniper"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;binary_in_deb&nbsp;=&nbsp;<span class="string">"usr/bin/bam-somaticsniper1.0.3"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;install_program&nbsp;~path&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">KEDSL</span>.<span class="constructor">Program</span>.(shf&nbsp;<span class="string">"mv&nbsp;%s/%s&nbsp;%s/%s"</span>&nbsp;path&nbsp;binary_in_deb&nbsp;path&nbsp;binary)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;installable_tool&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.<span class="constructor">Default</span>.somaticsniper&nbsp;~install_program&nbsp;~url<br>
&nbsp;&nbsp;&nbsp;&nbsp;~witness:(witness_file&nbsp;binary)&nbsp;~init_program:add_to_dollar_path<br>
<br>
<br>
<br>
<span class="keyword">let</span>&nbsp;varscan&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;url&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"http://downloads.sourceforge.net/project/varscan/VarScan.v2.3.5.jar"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;jar&nbsp;=&nbsp;<span class="string">"VarScan.v2.3.5.jar"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;witness&nbsp;=&nbsp;witness_file&nbsp;jar&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;init_program&nbsp;~path&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">KEDSL</span>.<span class="constructor">Program</span>.(shf&nbsp;<span class="string">"export&nbsp;VARSCAN_JAR=%s/%s"</span>&nbsp;path&nbsp;jar)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;installable_tool&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.<span class="constructor">Default</span>.varscan&nbsp;~url&nbsp;~init_program&nbsp;~witness<br>
<br>
<span class="keyword">let</span>&nbsp;picard&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;url&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"https://github.com/broadinstitute/picard/releases/download/1.127/picard-tools-1.127.zip"</span><br>
&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;jar&nbsp;=&nbsp;<span class="string">"picard-tools-1.127"</span>&nbsp;//&nbsp;<span class="string">"picard.jar"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;init_program&nbsp;~path&nbsp;=&nbsp;<span class="constructor">KEDSL</span>.<span class="constructor">Program</span>.(shf&nbsp;<span class="string">"export&nbsp;PICARD_JAR=%s/%s"</span>&nbsp;path&nbsp;jar)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;installable_tool&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.<span class="constructor">Default</span>.picard&nbsp;~url&nbsp;~init_program<br>
&nbsp;&nbsp;&nbsp;&nbsp;~witness:(witness_file&nbsp;jar)<br>
<br>
<span class="keyword">type</span>&nbsp;broad_jar_location&nbsp;=&nbsp;[<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Scp</span>&nbsp;<span class="keyword">of</span>&nbsp;string<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Wget</span>&nbsp;<span class="keyword">of</span>&nbsp;string<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Fail</span>&nbsp;<span class="keyword">of</span>&nbsp;string<br>
]<br>
</code><table><tr><td></td><td><span class="comment">(**
   Mutect (and some other tools) are behind some web-login annoying thing:
   c.f. &lt;http://www.broadinstitute.org/cancer/cga/mutect_download&gt;
   So the user of the lib must provide an SSH or HTTP URL (or
   reimplement the `Tool.t` is some other way).
*)</span></td></tr></table><code class="code"><br>
<br>
<span class="keyword">let</span>&nbsp;get_broad_jar<br>
&nbsp;&nbsp;&nbsp;&nbsp;~(run_program&nbsp;:&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Make_fun</span>.t)<br>
&nbsp;&nbsp;&nbsp;&nbsp;~host&nbsp;~install_path&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;loc&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;<span class="keyword">open</span>&nbsp;<span class="constructor">KEDSL</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;jar_name&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;loc&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Fail</span>&nbsp;s&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">"cannot-get-broad-jar.jar"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Scp</span>&nbsp;s&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Filename</span>.basename&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Wget</span>&nbsp;s&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Filename</span>.basename&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;local_box_path&nbsp;=&nbsp;install_path&nbsp;//&nbsp;jar_name&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;<span class="keyword">open</span>&nbsp;<span class="constructor">KEDSL</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;workflow_node&nbsp;(single_file&nbsp;local_box_path&nbsp;~host)<br>
&nbsp;&nbsp;&nbsp;&nbsp;~name:(sprintf&nbsp;<span class="string">"get-%s"</span>&nbsp;jar_name)<br>
&nbsp;&nbsp;&nbsp;&nbsp;~edges:[<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;on_failure_activate&nbsp;(rm_path&nbsp;~host&nbsp;local_box_path)<br>
&nbsp;&nbsp;&nbsp;&nbsp;]<br>
&nbsp;&nbsp;&nbsp;&nbsp;~make:(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;run_program<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~requirements:[<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">`</span><span class="constructor">Internet_access</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">`</span><span class="constructor">Self_identification</span>&nbsp;[<span class="string">"broad-jar-instalation"</span>;&nbsp;jar_name];<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Program</span>.(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shf&nbsp;<span class="string">"mkdir&nbsp;-p&nbsp;%s"</span>&nbsp;install_path<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;<span class="keyword">begin</span>&nbsp;<span class="keyword">match</span>&nbsp;loc&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Fail</span>&nbsp;msg&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shf&nbsp;<span class="string">"echo&nbsp;'Cannot&nbsp;download&nbsp;Broad&nbsp;JAR:&nbsp;%s'"</span>&nbsp;msg<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;sh&nbsp;<span class="string">"exit&nbsp;4"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Scp</span>&nbsp;s&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shf&nbsp;<span class="string">"scp&nbsp;%s&nbsp;%s"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="constructor">Filename</span>.quote&nbsp;s)&nbsp;(<span class="constructor">Filename</span>.quote&nbsp;local_box_path)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Wget</span>&nbsp;s&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shf&nbsp;<span class="string">"wget&nbsp;%s&nbsp;-O&nbsp;%s"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="constructor">Filename</span>.quote&nbsp;s)&nbsp;(<span class="constructor">Filename</span>.quote&nbsp;local_box_path)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>))<br>
<br>
<span class="keyword">let</span>&nbsp;mutect_tool<br>
&nbsp;&nbsp;&nbsp;&nbsp;~(run_program&nbsp;:&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Make_fun</span>.t)<br>
&nbsp;&nbsp;&nbsp;&nbsp;~host&nbsp;~install_tools_path&nbsp;loc&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;tool&nbsp;=&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.<span class="constructor">Default</span>.mutect&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;<span class="keyword">open</span>&nbsp;<span class="constructor">KEDSL</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;install_path&nbsp;=&nbsp;install_tools_path&nbsp;//&nbsp;<span class="constructor">Tool_def</span>.to_directory_name&nbsp;tool&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;get_mutect&nbsp;=&nbsp;get_broad_jar&nbsp;~run_program&nbsp;~host&nbsp;~install_path&nbsp;loc&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.create&nbsp;tool&nbsp;~ensure:get_mutect<br>
&nbsp;&nbsp;&nbsp;&nbsp;~init:<span class="constructor">Program</span>.(shf&nbsp;<span class="string">"export&nbsp;mutect_HOME=%s"</span>&nbsp;install_path)<br>
<br>
<span class="keyword">let</span>&nbsp;gatk_tool<br>
&nbsp;&nbsp;&nbsp;&nbsp;~(run_program&nbsp;:&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Make_fun</span>.t)<br>
&nbsp;&nbsp;&nbsp;&nbsp;~host&nbsp;~install_tools_path&nbsp;loc&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;tool&nbsp;=&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.<span class="constructor">Default</span>.gatk&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;<span class="keyword">open</span>&nbsp;<span class="constructor">KEDSL</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;install_path&nbsp;=&nbsp;install_tools_path&nbsp;//&nbsp;<span class="constructor">Tool_def</span>.to_directory_name&nbsp;tool&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ensure&nbsp;=&nbsp;get_broad_jar&nbsp;~run_program&nbsp;~host&nbsp;~install_path&nbsp;loc&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.create&nbsp;tool&nbsp;~ensure<br>
&nbsp;&nbsp;&nbsp;&nbsp;~init:<span class="constructor">Program</span>.(shf&nbsp;<span class="string">"export&nbsp;GATK_JAR=%s"</span>&nbsp;ensure<span class="keywordsign">#</span>product<span class="keywordsign">#</span>path)<br>
<br>
</code><table><tr><td></td><td><span class="comment">(** 
<p>

Strelka is built from source but does not seem to build on MacOSX.
<p>

*)</span></td></tr></table><code class="code"><br>
<span class="keyword">let</span>&nbsp;strelka&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;url&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"ftp://strelka:%27%27@ftp.illumina.com/v1-branch/v1.0.14/strelka_workflow-1.0.14.tar.gz"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;strelka_bin&nbsp;=&nbsp;<span class="string">"usr"</span>&nbsp;//&nbsp;<span class="string">"bin"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;witness&nbsp;=&nbsp;witness_file&nbsp;@@&nbsp;strelka_bin&nbsp;//&nbsp;<span class="string">"configureStrelkaWorkflow.pl"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;install_program&nbsp;~path&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;C.f.&nbsp;ftp://ftp.illumina.com/v1-branch/v1.0.14/README&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">KEDSL</span>.<span class="constructor">Program</span>.(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shf&nbsp;<span class="string">"./configure&nbsp;--prefix=%s"</span>&nbsp;(path&nbsp;//&nbsp;<span class="string">"usr"</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;sh&nbsp;<span class="string">"make&nbsp;&amp;&amp;&nbsp;make&nbsp;install"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;)<br>
&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;init_program&nbsp;~path&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">KEDSL</span>.<span class="constructor">Program</span>.(shf&nbsp;<span class="string">"export&nbsp;STRELKA_BIN=%s/%s"</span>&nbsp;path&nbsp;strelka_bin)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;installable_tool&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.<span class="constructor">Default</span>.strelka&nbsp;~url<br>
&nbsp;&nbsp;&nbsp;&nbsp;~init_program&nbsp;~install_program&nbsp;~witness<br>
<br>
<span class="keyword">let</span>&nbsp;virmid&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;url&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"http://downloads.sourceforge.net/project/virmid/virmid-1.1.1.tar.gz"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;jar&nbsp;=&nbsp;<span class="string">"Virmid-1.1.1"</span>&nbsp;//&nbsp;<span class="string">"Virmid.jar"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;init_program&nbsp;~path&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">KEDSL</span>.<span class="constructor">Program</span>.(shf&nbsp;<span class="string">"export&nbsp;VIRMID_JAR=%s/%s"</span>&nbsp;path&nbsp;jar)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;installable_tool&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.<span class="constructor">Default</span>.virmid&nbsp;~url&nbsp;~init_program<br>
&nbsp;&nbsp;&nbsp;&nbsp;~unarchived_directory:<span class="string">"."</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;~witness:(witness_file&nbsp;jar)<br>
<br>
<span class="keyword">let</span>&nbsp;muse&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;url&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"http://bioinformatics.mdanderson.org/Software/MuSE/MuSEv1.0b"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;binary&nbsp;=&nbsp;<span class="string">"MuSEv1.0b"</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;install_program&nbsp;~path&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">KEDSL</span>.<span class="constructor">Program</span>.(&nbsp;shf&nbsp;<span class="string">"chmod&nbsp;+x&nbsp;%s/%s"</span>&nbsp;path&nbsp;binary)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;init_program&nbsp;~path&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">KEDSL</span>.<span class="constructor">Program</span>.(shf&nbsp;<span class="string">"export&nbsp;muse_bin=%s/%s"</span>&nbsp;path&nbsp;binary)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;installable_tool&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.<span class="constructor">Default</span>.muse&nbsp;~url<br>
&nbsp;&nbsp;&nbsp;&nbsp;~install_program&nbsp;~init_program<br>
&nbsp;&nbsp;&nbsp;&nbsp;~witness:(witness_file&nbsp;binary)<br>
<br>
<span class="keyword">let</span>&nbsp;default_jar_location&nbsp;msg&nbsp;():&nbsp;broad_jar_location&nbsp;=<br>
&nbsp;&nbsp;<span class="keywordsign">`</span><span class="constructor">Fail</span>&nbsp;(sprintf&nbsp;<span class="string">"No&nbsp;location&nbsp;provided&nbsp;for&nbsp;%s"</span>&nbsp;msg)<br>
<br>
<span class="keyword">let</span>&nbsp;default_toolkit<br>
&nbsp;&nbsp;&nbsp;&nbsp;~run_program<br>
&nbsp;&nbsp;&nbsp;&nbsp;~host&nbsp;~install_tools_path<br>
&nbsp;&nbsp;&nbsp;&nbsp;?(mutect_jar_location&nbsp;=&nbsp;default_jar_location&nbsp;<span class="string">"Mutect"</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;?(gatk_jar_location&nbsp;=&nbsp;default_jar_location&nbsp;<span class="string">"GATK"</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;()&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;install&nbsp;installable&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;render_installable_tool&nbsp;~host&nbsp;installable&nbsp;~install_tools_path&nbsp;~run_program<br>
&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.<span class="constructor">Kit</span>.concat&nbsp;[<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.<span class="constructor">Kit</span>.of_list&nbsp;[<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mutect_tool&nbsp;~run_program&nbsp;~host&nbsp;~install_tools_path&nbsp;(mutect_jar_location&nbsp;());<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gatk_tool&nbsp;~run_program&nbsp;~host&nbsp;~install_tools_path&nbsp;(gatk_jar_location&nbsp;());<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;install&nbsp;bwa;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;install&nbsp;samtools;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;install&nbsp;bedtools;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;install&nbsp;vcftools;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;install&nbsp;strelka;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;install&nbsp;picard;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;install&nbsp;somaticsniper;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;install&nbsp;varscan;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;install&nbsp;muse;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;install&nbsp;virmid;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;install&nbsp;star;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;install&nbsp;stringtie;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;install&nbsp;cufflinks;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;install&nbsp;@@&nbsp;hisat&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.<span class="constructor">Default</span>.hisat;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;install&nbsp;@@&nbsp;hisat&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.<span class="constructor">Default</span>.hisat2;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;install&nbsp;mosaik;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;install&nbsp;kallisto;<br>
&nbsp;&nbsp;&nbsp;&nbsp;];<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Biopam</span>.default&nbsp;~run_program&nbsp;~host<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~install_path:(install_tools_path&nbsp;//&nbsp;<span class="string">"biopam-kit"</span>)&nbsp;();<br>
&nbsp;&nbsp;]<br>
<br>
<span class="keyword">end</span></code></body></html>