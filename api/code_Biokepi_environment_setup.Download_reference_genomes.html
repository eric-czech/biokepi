<html><head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of extensions" rel=Appendix href="index_extensions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Biokepi_run_environment" rel="Chapter" href="Biokepi_run_environment.html">
<link title="Biokepi_environment_setup" rel="Chapter" href="Biokepi_environment_setup.html">
<link title="Biokepi_bfx_tools" rel="Chapter" href="Biokepi_bfx_tools.html">
<link title="Biokepi_pipeline_edsl" rel="Chapter" href="Biokepi_pipeline_edsl.html">
<link title="All_downloads" rel="Chapter" href="All_downloads.html">
<link title="Main" rel="Chapter" href="Main.html">
<link title="Ttfi_pipeline" rel="Chapter" href="Ttfi_pipeline.html">
<link title="Biokepi" rel="Chapter" href="Biokepi.html"><title>Biokepi API : Biokepi_environment_setup.Download_reference_genomes</title>
</head>
<body>
<code class="code">:&nbsp;<span class="keyword">sig</span><br>
</code><table><tr><td></td><td><span class="comment">(** Download reference-genormes (&amp; associated data) with Ketrew *)</span></td></tr></table><code class="code"><br>
<span class="keyword">open</span>&nbsp;<span class="constructor">Biokepi_run_environment</span><br>
<br>
<span class="keyword">type</span>&nbsp;pull_function&nbsp;=<br>
&nbsp;&nbsp;toolkit:<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.<span class="constructor">Kit</span>.t&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;host:<span class="constructor">Common</span>.<span class="constructor">KEDSL</span>.<span class="constructor">Host</span>.t&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;run_program:<span class="constructor">Machine</span>.<span class="constructor">Make_fun</span>.t&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;destination_path:string&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Reference_genome</span>.t<br>
<br>
<span class="keyword">val</span>&nbsp;pull_b37&nbsp;:&nbsp;pull_function<br>
<span class="keyword">val</span>&nbsp;pull_b37decoy&nbsp;:&nbsp;pull_function<br>
<span class="keyword">val</span>&nbsp;pull_b38&nbsp;:&nbsp;pull_function<br>
<span class="keyword">val</span>&nbsp;pull_hg18&nbsp;:&nbsp;pull_function<br>
<span class="keyword">val</span>&nbsp;pull_hg19&nbsp;:&nbsp;pull_function<br>
<span class="keyword">val</span>&nbsp;pull_mm10&nbsp;:&nbsp;pull_function<br>
<br>
<br>
<span class="keyword">val</span>&nbsp;default_genome_providers&nbsp;:&nbsp;(string&nbsp;*&nbsp;pull_function)&nbsp;list<br>
<br>
<span class="keyword">val</span>&nbsp;get_reference_genome&nbsp;:&nbsp;string&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;pull_function<br>
<span class="keyword">end</span>&nbsp;<br>
=&nbsp;<span class="keyword">struct</span><br>
<span class="keyword">open</span>&nbsp;<span class="constructor">Biokepi_run_environment</span><br>
<span class="keyword">open</span>&nbsp;<span class="constructor">Common</span><br>
<br>
<br>
<br>
<span class="keyword">open</span>&nbsp;<span class="constructor">Workflow_utilities</span>.<span class="constructor">Download</span>&nbsp;<span class="comment">(*&nbsp;All&nbsp;the&nbsp;wget*&nbsp;functions&nbsp;*)</span><br>
<span class="keyword">module</span>&nbsp;<span class="constructor">Vcftools</span>&nbsp;=&nbsp;<span class="constructor">Workflow_utilities</span>.<span class="constructor">Vcftools</span><br>
<br>
<span class="keyword">let</span>&nbsp;of_specification<br>
&nbsp;&nbsp;&nbsp;&nbsp;~toolkit&nbsp;~host&nbsp;~run_program&nbsp;~destination_path&nbsp;specification&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;<span class="keyword">open</span>&nbsp;<span class="constructor">Reference_genome</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Specification</span>.<br>
&nbsp;&nbsp;&nbsp;&nbsp;name;<br>
&nbsp;&nbsp;&nbsp;&nbsp;metadata;<br>
&nbsp;&nbsp;&nbsp;&nbsp;fasta;<br>
&nbsp;&nbsp;&nbsp;&nbsp;dbsnp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;cosmic;<br>
&nbsp;&nbsp;&nbsp;&nbsp;exome_gtf;&nbsp;<span class="comment">(*&nbsp;maybe&nbsp;desrves&nbsp;a&nbsp;better&nbsp;name?&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;cdna;<br>
&nbsp;&nbsp;&nbsp;&nbsp;major_contigs;<br>
&nbsp;&nbsp;}&nbsp;=&nbsp;specification&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;dest_file&nbsp;f&nbsp;=&nbsp;destination_path&nbsp;//&nbsp;name&nbsp;//&nbsp;f&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;compile_location&nbsp;filename&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">function</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Url</span>&nbsp;url&nbsp;<span class="comment">(*&nbsp;Right&nbsp;now,&nbsp;`wget_gunzip`&nbsp;is&nbsp;clever&nbsp;enough&nbsp;to&nbsp;not&nbsp;gunzip&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Gunzip</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Url</span>&nbsp;url&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Workflow_utilities</span>.<span class="constructor">Download</span>.wget_gunzip<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~host&nbsp;~run_program&nbsp;~destination:(dest_file&nbsp;filename)&nbsp;url<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="keywordsign">`</span><span class="constructor">Vcf_concat</span>&nbsp;l&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vcfs&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">List</span>.map&nbsp;~f:(<span class="keyword">fun</span>&nbsp;(n,&nbsp;loc)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;compile_location&nbsp;n&nbsp;loc)&nbsp;l<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;vcftools&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.<span class="constructor">Kit</span>.get_exn&nbsp;toolkit&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.<span class="constructor">Default</span>.vcftools&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;concated&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;tmp_vcf&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dest_file&nbsp;(<span class="constructor">Filename</span>.chop_extension&nbsp;filename&nbsp;^&nbsp;<span class="string">"-cat.vcf"</span>)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Vcftools</span>.vcf_concat_no_machine<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~host&nbsp;~vcftools&nbsp;~run_program&nbsp;~final_vcf:tmp_vcf&nbsp;vcfs&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;sorted&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;final_vcf_path&nbsp;=&nbsp;dest_file&nbsp;filename&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Vcftools</span>.vcf_sort_no_machine<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~host&nbsp;~vcftools&nbsp;~run_program<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~src:concated&nbsp;~dest:final_vcf_path&nbsp;()&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sorted<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;other&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;failwithf&nbsp;<span class="string">"Reference_genome.compile_location&nbsp;this&nbsp;kind&nbsp;of&nbsp;location&nbsp;is&nbsp;not&nbsp;yet&nbsp;implemented"</span><br>
&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;compile_location_opt&nbsp;filename&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Option</span>.map&nbsp;~f:(compile_location&nbsp;filename)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;create&nbsp;specification<br>
&nbsp;&nbsp;&nbsp;&nbsp;(compile_location&nbsp;(name&nbsp;^&nbsp;<span class="string">".fasta"</span>)&nbsp;fasta)<br>
&nbsp;&nbsp;&nbsp;&nbsp;?cosmic:(compile_location_opt&nbsp;<span class="string">"cosmic.vcf"</span>&nbsp;cosmic)<br>
&nbsp;&nbsp;&nbsp;&nbsp;?dbsnp:(compile_location_opt&nbsp;<span class="string">"dbsnp.vcf"</span>&nbsp;dbsnp)<br>
&nbsp;&nbsp;&nbsp;&nbsp;?gtf:(compile_location_opt&nbsp;<span class="string">"transcripts.gtf"</span>&nbsp;exome_gtf)<br>
&nbsp;&nbsp;&nbsp;&nbsp;?cdna:(compile_location_opt&nbsp;<span class="string">"cdns-all.fa"</span>&nbsp;cdna)<br>
<br>
<span class="keyword">type</span>&nbsp;pull_function&nbsp;=<br>
&nbsp;&nbsp;toolkit:<span class="constructor">Machine</span>.<span class="constructor">Tool</span>.<span class="constructor">Kit</span>.t&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;host:<span class="constructor">Common</span>.<span class="constructor">KEDSL</span>.<span class="constructor">Host</span>.t&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;run_program:<span class="constructor">Machine</span>.<span class="constructor">Make_fun</span>.t&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;destination_path:string&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Reference_genome</span>.t<br>
<br>
<br>
<span class="keyword">let</span>&nbsp;pull_b37&nbsp;~toolkit&nbsp;~host&nbsp;~(run_program&nbsp;:&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Make_fun</span>.t)&nbsp;~destination_path&nbsp;=<br>
&nbsp;&nbsp;of_specification&nbsp;~toolkit&nbsp;~host&nbsp;~run_program&nbsp;~destination_path<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Reference_genome</span>.<span class="constructor">Specification</span>.<span class="constructor">Default</span>.b37<br>
<br>
<span class="keyword">let</span>&nbsp;pull_b37decoy&nbsp;~toolkit&nbsp;~host&nbsp;~(run_program&nbsp;:&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Make_fun</span>.t)&nbsp;~destination_path&nbsp;=<br>
&nbsp;&nbsp;of_specification&nbsp;~toolkit&nbsp;~host&nbsp;~run_program&nbsp;~destination_path<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Reference_genome</span>.<span class="constructor">Specification</span>.<span class="constructor">Default</span>.b37decoy<br>
<br>
<span class="keyword">let</span>&nbsp;pull_b38&nbsp;~toolkit&nbsp;~host&nbsp;~(run_program&nbsp;:&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Make_fun</span>.t)&nbsp;~destination_path&nbsp;=<br>
&nbsp;&nbsp;of_specification&nbsp;~toolkit&nbsp;~host&nbsp;~run_program&nbsp;~destination_path<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Reference_genome</span>.<span class="constructor">Specification</span>.<span class="constructor">Default</span>.b38<br>
<br>
<span class="keyword">let</span>&nbsp;pull_hg19&nbsp;~toolkit&nbsp;~host&nbsp;~(run_program&nbsp;:&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Make_fun</span>.t)&nbsp;~destination_path&nbsp;=<br>
&nbsp;&nbsp;of_specification&nbsp;~toolkit&nbsp;~host&nbsp;~run_program&nbsp;~destination_path<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Reference_genome</span>.<span class="constructor">Specification</span>.<span class="constructor">Default</span>.hg19<br>
<br>
<span class="keyword">let</span>&nbsp;pull_hg18&nbsp;~toolkit&nbsp;~host&nbsp;~(run_program&nbsp;:&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Make_fun</span>.t)&nbsp;~destination_path&nbsp;=<br>
&nbsp;&nbsp;of_specification&nbsp;~toolkit&nbsp;~host&nbsp;~run_program&nbsp;~destination_path<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Reference_genome</span>.<span class="constructor">Specification</span>.<span class="constructor">Default</span>.hg18<br>
<br>
<span class="keyword">let</span>&nbsp;pull_mm10&nbsp;~toolkit&nbsp;~host&nbsp;~(run_program&nbsp;:&nbsp;<span class="constructor">Machine</span>.<span class="constructor">Make_fun</span>.t)&nbsp;~destination_path&nbsp;=<br>
&nbsp;&nbsp;of_specification&nbsp;~toolkit&nbsp;~host&nbsp;~run_program&nbsp;~destination_path<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Reference_genome</span>.<span class="constructor">Specification</span>.<span class="constructor">Default</span>.mm10<br>
<br>
<span class="keyword">let</span>&nbsp;default_genome_providers&nbsp;=&nbsp;[<br>
&nbsp;&nbsp;<span class="constructor">Reference_genome</span>.<span class="constructor">Specification</span>.<span class="constructor">Default</span>.<span class="constructor">Name</span>.b37,&nbsp;pull_b37;<br>
&nbsp;&nbsp;<span class="constructor">Reference_genome</span>.<span class="constructor">Specification</span>.<span class="constructor">Default</span>.<span class="constructor">Name</span>.b37decoy,&nbsp;pull_b37decoy;<br>
&nbsp;&nbsp;<span class="constructor">Reference_genome</span>.<span class="constructor">Specification</span>.<span class="constructor">Default</span>.<span class="constructor">Name</span>.b38,&nbsp;pull_b38;<br>
&nbsp;&nbsp;<span class="constructor">Reference_genome</span>.<span class="constructor">Specification</span>.<span class="constructor">Default</span>.<span class="constructor">Name</span>.hg18,&nbsp;pull_hg18;<br>
&nbsp;&nbsp;<span class="constructor">Reference_genome</span>.<span class="constructor">Specification</span>.<span class="constructor">Default</span>.<span class="constructor">Name</span>.hg19,&nbsp;pull_hg19;<br>
&nbsp;&nbsp;<span class="constructor">Reference_genome</span>.<span class="constructor">Specification</span>.<span class="constructor">Default</span>.<span class="constructor">Name</span>.mm10,&nbsp;pull_mm10;<br>
]<br>
<br>
<span class="keyword">let</span>&nbsp;get_reference_genome&nbsp;name&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;<span class="constructor">List</span>.find&nbsp;default_genome_providers&nbsp;~f:(<span class="keyword">fun</span>&nbsp;(a,&nbsp;_)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;a&nbsp;=&nbsp;name)&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Some</span>&nbsp;(_,&nbsp;pull)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;pull<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">None</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwithf&nbsp;<span class="string">"Cannot&nbsp;find&nbsp;the&nbsp;reference&nbsp;genorme&nbsp;called&nbsp;%S"</span>&nbsp;name<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
<span class="keyword">end</span></code></body></html>